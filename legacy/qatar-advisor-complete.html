<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qatar Manufacturing Advisor | Oliver Wyman</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // =============================================
    // CONFIGURATION - EDIT THESE VALUES
    // =============================================
    const CONFIG = {
      WEBHOOK_URL: 'YOUR_N8N_WEBHOOK_URL_HERE', // Replace with your n8n URL
      DEMO_MODE: true, // Set to false when n8n is connected
      SHOW_SIMULATOR: true, // Show the scenario simulator tab
    };

    // =============================================
    // MOCK DATA (Used when DEMO_MODE is true)
    // =============================================
    const mockResponses = {
      default: {
        executive: `The biggest opportunity in Qatar manufacturing is the **combination of technology adoption and workforce upskilling**, which could add **QAR 11.3 billion to GDP over 5 years**.

Currently, Qatar's manufacturing productivity is 34% below GCC benchmarks, and Industry 4.0 adoption sits at just 18% compared to 45% in UAE. However, our analysis of 127 firms shows this gap can be closed rapidly with the right interventions.

The recommended approach: start with lean manufacturing basics in the top 50 firms (achievable in 12 months, $50-100K per firm), then scale digital transformation. This creates **QAR 400-750M in quick wins** while building the foundation for larger programs.

The key enabler is talent â€” you'll need 2,400 digital technicians by 2028. Would you like me to detail the talent pipeline or dive into specific sectors?`,
        analyst: `**Research Findings:**
â€¢ Manufacturing GDP: QAR 62.3B (9.2% of non-hydrocarbon GDP)
â€¢ QNV 2030 target: 15% of non-hydrocarbon GDP
â€¢ Current productivity: 34% below GCC, 52% below global best-in-class
â€¢ I4.0 adoption: 18% (UAE: 45%, Singapore: 67%)
â€¢ Lean manufacturing adoption: Only 23% of firms
â€¢ Skills gap: 89% of executives cite as critical barrier

**Confidence Level:** High (Â±10%) â€” based on direct Qatar survey data`,
        strategist: `**Strategic Insights:**
1. The productivity-technology gap represents the largest addressable opportunity
2. Quick wins are available through lean basics before digital transformation
3. Talent is the binding constraint â€” must be addressed in parallel

**Recommended Interventions:**
â€¢ Phase 1 (0-12 months): Lean Manufacturing - $2.5-5M, +20-30% productivity
â€¢ Phase 2 (6-24 months): Digital Foundation - $150-300M
â€¢ Phase 3 (12-36 months): I4.0 Scale-up - $400-600M

**GDP Impact:** Year 5: +QAR 11.3B cumulative`
      },
      food: {
        executive: `**Food & Beverage is Qatar's highest-growth manufacturing opportunity**, with potential to add **QAR 9.3 billion to GDP and create 28,000 jobs** in the aggressive scenario.

The strategic logic is compelling: Qatar imports 90% of its food, making food security a national priority. Yet local F&B manufacturing operates at only 61% capacity utilization, and export penetration is 12% versus 34% GCC average.

Our recommended strategy is the **"Halal Hub"** â€” position Qatar as the premium halal processing center for GCC exports. This requires $2.1B investment over 5 years, primarily in cold chain infrastructure ($340M) and processing capacity expansion.

Want me to break down the investment requirements or discuss the regulatory enablers?`,
        analyst: `**Research Findings:**
â€¢ F&B establishments: 89 registered
â€¢ Current output: $2.8B annually
â€¢ Capacity utilization: 61%
â€¢ Food import dependency: 90%
â€¢ Post-harvest loss: 18% (cold chain gap)

**Growth Scenarios:**
â€¢ Baseline ($0): +QAR 1.2B, 3,200 jobs
â€¢ Moderate ($800M): +QAR 4.8B, 12,500 jobs  
â€¢ Aggressive ($2.1B): +QAR 9.3B, 28,000 jobs

**Confidence Level:** Medium (Â±25%)`,
        strategist: `**Strategic Insights:**
1. Food security mandate creates natural demand pull
2. Halal certification provides differentiation
3. Current underutilization means quick capacity gains possible

**Recommended "Halal Hub" Strategy:**
â€¢ Cold Chain Infrastructure: $340M
â€¢ Processing Capacity: $1.2B
â€¢ Vertical Integration: $400M
â€¢ Regulatory Reform: Reduce licensing from 14 to 3 months`
      },
      productivity: {
        executive: `**Productivity improvement represents QAR 8.2 billion in GDP potential**, with the fastest path being lean manufacturing transformation in top firms.

Our assessment of 127 Qatar manufacturing firms reveals current productivity is **34% below GCC benchmarks** and **52% below global best-in-class**. Despite $4.2B in capital investment over 5 years, labor productivity grew only 2.1% annually.

The root causes: automation-skills mismatch (firms invested in equipment without workforce capabilities), fragmented systems (average firm uses 7+ disconnected platforms), and limited lean adoption (only 23% of firms).

**Recommended quick win:** Lean Manufacturing Transformation for top 50 firms
â€¢ Timeline: 12 months
â€¢ Investment: $50-100K per firm
â€¢ Expected outcome: +15-25pp OEE, +20-30% labor productivity
â€¢ GDP impact: **+QAR 400-750M in year one alone**

Should I detail the implementation roadmap or explore how this connects to digital transformation?`,
        analyst: `**Research Findings:**
â€¢ Productivity gap: 34% below GCC, 52% below global
â€¢ Capital investment (5 years): $4.2B
â€¢ Productivity growth: Only 2.1% annually
â€¢ Lean adoption: 23% of firms
â€¢ Average disconnected systems per firm: 7+

**Root Causes:**
1. Automation-skills mismatch
2. Fragmented digital systems
3. Limited lean manufacturing practices

**Confidence Level:** High (Â±10%)`,
        strategist: `**Recommended Intervention: Lean Manufacturing Transformation**
â€¢ Target: Firms with <60% OEE (Overall Equipment Effectiveness)
â€¢ Approach: 12-month program

**Phases:**
1. Diagnostic and Value Stream Mapping (Month 1-2)
2. 5S and visual management (Month 3-4)
3. TPM implementation (Month 5-8)
4. Continuous improvement culture (Month 9-12)

**Expected Outcomes:**
â€¢ OEE improvement: +15-25 percentage points
â€¢ Labor productivity: +20-30%
â€¢ Quality defects: -40%
â€¢ GDP contribution per firm: +QAR 8-15M annually`
      },
      technology: {
        executive: `**Digital transformation could add QAR 6.8 billion to GDP**, but Qatar currently lags significantly behind regional competitors.

Our Digital Manufacturing Maturity Index assessment shows stark gaps:
â€¢ **Qatar I4.0 adoption: 18%**
â€¢ UAE: 45%
â€¢ Singapore: 67%

The maturity distribution is concerning: 42% of firms are still at Level 1 (paper-based), only 7% have reached Level 4 (predictive AI/ML).

**Highest-ROI digital use cases:**

1. **Predictive Quality Control** â€” $1.2M investment, 14-month payback, 23-31% defect reduction

2. **Energy Optimization** â€” $650K investment, 18-month payback, 8-15% cost reduction

3. **Digital Twin** â€” $2.4M investment, 26-month payback, 12% throughput increase

The combined multiplier effect is **2.2x** â€” meaning every QAR invested generates 2.2 QAR in economic value.

Would you like me to walk through the implementation roadmap or focus on a specific sector?`,
        analyst: `**Digital Maturity Distribution:**
â€¢ Level 1 Basic (paper-based): 42%
â€¢ Level 2 Connected (ERP): 31%
â€¢ Level 3 Visible (IoT): 18%
â€¢ Level 4 Predictive (AI/ML): 7%
â€¢ Level 5 Autonomous: 2%

**Regional Comparison:**
â€¢ Qatar I4.0 adoption: 18%
â€¢ UAE: 45%
â€¢ Singapore: 67%

**Confidence Level:** High (Â±10%)`,
        strategist: `**High-Impact Digital Use Cases:**

1. **Predictive Quality Control**
   â€¢ Investment: $1.2M | Payback: 14 months
   â€¢ Impact: 23-31% defect reduction
   â€¢ Best for: Petrochemicals, building materials

2. **Energy Optimization**
   â€¢ Investment: $650K | Payback: 18 months
   â€¢ Impact: 8-15% energy cost reduction
   â€¢ Best for: Cement, steel, aluminum

3. **Digital Twin**
   â€¢ Investment: $2.4M | Payback: 26 months
   â€¢ Impact: 12% throughput, -22% maintenance cost

**Implementation Roadmap:**
â€¢ Months 1-6: Foundation (data, governance, quick wins)
â€¢ Months 7-18: Scale (enterprise rollout, upskilling)
â€¢ Months 19-36: Transform (AI/ML, ecosystem integration)`
      }
    };

    const getFollowUps = (topic) => {
      const map = {
        default: ["Break down the talent pipeline", "Compare to UAE and Saudi", "Show me the F&B opportunity", "What's the implementation roadmap?"],
        food: ["What's the investment breakdown?", "How do we compete with UAE?", "Detail the cold chain requirements", "Show me the regulatory blockers"],
        productivity: ["Which firms should we target first?", "What does the lean program look like?", "How do we measure success?", "Connect this to digital transformation"],
        technology: ["Show me the ROI by use case", "What's the talent requirement?", "How do other GCC countries compare?", "What's the quick win?"]
      };
      return map[topic] || map.default;
    };

    const getResponseData = (message) => {
      const lower = message.toLowerCase();
      if (lower.includes('food') || lower.includes('beverage') || lower.includes('f&b') || lower.includes('halal')) {
        return { data: mockResponses.food, topic: 'food' };
      }
      if (lower.includes('productivity') || lower.includes('lean') || lower.includes('efficiency')) {
        return { data: mockResponses.productivity, topic: 'productivity' };
      }
      if (lower.includes('technology') || lower.includes('digital') || lower.includes('i4.0') || lower.includes('industry 4')) {
        return { data: mockResponses.technology, topic: 'technology' };
      }
      return { data: mockResponses.default, topic: 'default' };
    };

    // =============================================
    // SCENARIO SIMULATOR COMPONENT
    // =============================================
    function ScenarioSimulator() {
      const [scenarios, setScenarios] = useState({
        leanAdoption: 30,
        techInvestment: 500,
        localizationTarget: 35,
        workforceTraining: 5000,
      });
      const [timeHorizon, setTimeHorizon] = useState(5);

      const impacts = useMemo(() => {
        const baseGDP = 62.3;
        const leanFirms = Math.round(1247 * (scenarios.leanAdoption / 100));
        const leanImpact = leanFirms * 0.05 * 0.23 * 2.0;
        const techImpact = (scenarios.techInvestment * 3.6 / 1000) * 0.15 * 2.2 * timeHorizon;
        const localizationImpact = 45 * (scenarios.localizationTarget / 100) * 0.4 * 2.8;
        const workforceImpact = scenarios.workforceTraining * 0.00005 * 2.0 * timeHorizon;
        const total = leanImpact + techImpact + localizationImpact + workforceImpact;
        return {
          lean: leanImpact, tech: techImpact, localization: localizationImpact, workforce: workforceImpact,
          total, percentIncrease: (total / baseGDP) * 100, jobs: Math.round(total * 3000), newGDP: baseGDP + total
        };
      }, [scenarios, timeHorizon]);

      const Slider = ({ label, value, onChange, min, max, step, unit, desc }) => (
        <div style={{ marginBottom: 24 }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
            <span style={{ fontWeight: 500 }}>{label}</span>
            <span style={{ fontWeight: 600, color: '#00b4d8', fontSize: 18 }}>{value.toLocaleString()}{unit}</span>
          </div>
          <input type="range" min={min} max={max} step={step} value={value} onChange={e => onChange(Number(e.target.value))}
            style={{ width: '100%', height: 8, borderRadius: 4, background: 'rgba(255,255,255,0.1)', cursor: 'pointer', WebkitAppearance: 'none' }} />
          <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.4)', marginTop: 6 }}>{desc}</div>
        </div>
      );

      const ImpactBar = ({ label, value, color, icon }) => (
        <div style={{ marginBottom: 16 }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>
            <span>{icon}</span>
            <span style={{ flex: 1, fontSize: 14 }}>{label}</span>
            <span style={{ fontWeight: 600, color: '#00b4d8' }}>+QAR {value.toFixed(1)}B</span>
          </div>
          <div style={{ height: 8, background: 'rgba(255,255,255,0.1)', borderRadius: 4, overflow: 'hidden' }}>
            <div style={{ height: '100%', width: `${Math.min((value / 15) * 100, 100)}%`, background: color, borderRadius: 4, transition: 'width 0.3s' }} />
          </div>
        </div>
      );

      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24, padding: 24 }}>
          <div style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: 16, padding: 24 }}>
            <div style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: 1.5, color: 'rgba(255,255,255,0.5)', marginBottom: 20 }}>Intervention Parameters</div>
            <div style={{ display: 'flex', gap: 10, marginBottom: 24 }}>
              {[3, 5, 7, 10].map(y => (
                <button key={y} onClick={() => setTimeHorizon(y)}
                  style={{ flex: 1, padding: 10, background: timeHorizon === y ? 'rgba(0,180,216,0.2)' : 'rgba(255,255,255,0.05)',
                    border: `1px solid ${timeHorizon === y ? '#00b4d8' : 'rgba(255,255,255,0.1)'}`, borderRadius: 8,
                    color: timeHorizon === y ? '#00b4d8' : '#e8eaed', fontSize: 13, cursor: 'pointer' }}>{y} Years</button>
              ))}
            </div>
            <Slider label="Lean Manufacturing Adoption" value={scenarios.leanAdoption} onChange={v => setScenarios(s => ({...s, leanAdoption: v}))}
              min={0} max={80} step={5} unit="%" desc={`${Math.round(1247 * (scenarios.leanAdoption / 100))} of 1,247 firms`} />
            <Slider label="Industry 4.0 Investment" value={scenarios.techInvestment} onChange={v => setScenarios(s => ({...s, techInvestment: v}))}
              min={0} max={2000} step={50} unit="M USD" desc="IoT, AI/ML, predictive maintenance, digital twins" />
            <Slider label="Import Substitution Target" value={scenarios.localizationTarget} onChange={v => setScenarios(s => ({...s, localizationTarget: v}))}
              min={0} max={60} step={5} unit="%" desc="Percentage of imports produced locally" />
            <Slider label="Workforce Upskilling" value={scenarios.workforceTraining} onChange={v => setScenarios(s => ({...s, workforceTraining: v}))}
              min={0} max={20000} step={500} unit=" workers" desc="Workers trained in digital manufacturing" />
          </div>
          <div style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: 16, padding: 24 }}>
            <div style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: 1.5, color: 'rgba(255,255,255,0.5)', marginBottom: 20 }}>Projected Impact</div>
            <div style={{ background: 'linear-gradient(135deg, rgba(0,180,216,0.15), rgba(0,119,182,0.15))', border: '1px solid rgba(0,180,216,0.3)',
              borderRadius: 12, padding: 20, textAlign: 'center', marginBottom: 20 }}>
              <div style={{ fontSize: 11, textTransform: 'uppercase', letterSpacing: 1, color: 'rgba(255,255,255,0.5)', marginBottom: 6 }}>Total GDP Impact ({timeHorizon} years)</div>
              <div style={{ fontFamily: "'DM Serif Display', serif", fontSize: 44, color: '#00b4d8' }}>+{impacts.total.toFixed(1)}<span style={{ fontSize: 22, opacity: 0.7 }}>B QAR</span></div>
              <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.6)', marginTop: 8 }}>{impacts.percentIncrease.toFixed(0)}% increase in manufacturing GDP</div>
            </div>
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 20 }}>
              <div style={{ background: 'rgba(255,255,255,0.03)', borderRadius: 10, padding: 14, textAlign: 'center' }}>
                <div style={{ fontSize: 22, fontWeight: 600 }}>{impacts.jobs.toLocaleString()}</div>
                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', marginTop: 4 }}>Jobs Created</div>
              </div>
              <div style={{ background: 'rgba(255,255,255,0.03)', borderRadius: 10, padding: 14, textAlign: 'center' }}>
                <div style={{ fontSize: 22, fontWeight: 600 }}>{impacts.newGDP.toFixed(1)}B</div>
                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', marginTop: 4 }}>New Manufacturing GDP</div>
              </div>
            </div>
            <ImpactBar label="Lean Manufacturing" value={impacts.lean} color="linear-gradient(90deg, #10b981, #34d399)" icon="âš™ï¸" />
            <ImpactBar label="Technology Investment" value={impacts.tech} color="linear-gradient(90deg, #6366f1, #818cf8)" icon="ðŸ¤–" />
            <ImpactBar label="Supply Chain Localization" value={impacts.localization} color="linear-gradient(90deg, #f59e0b, #fbbf24)" icon="ðŸ”—" />
            <ImpactBar label="Workforce Development" value={impacts.workforce} color="linear-gradient(90deg, #ec4899, #f472b6)" icon="ðŸ‘¥" />
            <div style={{ marginTop: 20, padding: 16, background: 'rgba(255,255,255,0.03)', borderRadius: 10 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10, fontSize: 12 }}>
                <span>Progress to QNV 2030 Target</span>
                <span style={{ color: '#ffd700' }}>Target: QAR 93.5B</span>
              </div>
              <div style={{ height: 10, background: 'rgba(255,255,255,0.1)', borderRadius: 5, overflow: 'hidden' }}>
                <div style={{ height: '100%', width: `${Math.min((impacts.newGDP / 93.5) * 100, 100)}%`, background: 'linear-gradient(90deg, #0077b6, #00b4d8)', borderRadius: 5, transition: 'width 0.3s' }} />
              </div>
              <div style={{ marginTop: 8, fontSize: 11, color: 'rgba(255,255,255,0.5)' }}>
                Projected: QAR {impacts.newGDP.toFixed(1)}B / 93.5B ({((impacts.newGDP / 93.5) * 100).toFixed(0)}%)
              </div>
            </div>
          </div>
        </div>
      );
    }

    // =============================================
    // CHAT COMPONENTS
    // =============================================
    function AgentLayers({ layers, isExpanded, onToggle }) {
      if (!layers) return null;
      return (
        <div style={{ marginTop: 16 }}>
          <button onClick={onToggle} style={{ display: 'flex', alignItems: 'center', gap: 8, width: '100%', padding: '10px 14px',
            background: 'rgba(0,0,0,0.2)', border: '1px dashed rgba(255,255,255,0.15)', borderRadius: 10,
            color: 'rgba(255,255,255,0.7)', fontSize: 12, cursor: 'pointer' }}>
            <span style={{ fontSize: 10 }}>{isExpanded ? 'â–¼' : 'â–¶'}</span>
            <span>View AI reasoning process</span>
            <span style={{ marginLeft: 'auto', display: 'flex', gap: 6 }}>
              <span style={{ padding: '2px 8px', borderRadius: 10, fontSize: 10, background: 'rgba(16,185,129,0.2)', color: '#10b981' }}>Analyst</span>
              <span style={{ padding: '2px 8px', borderRadius: 10, fontSize: 10, background: 'rgba(99,102,241,0.2)', color: '#818cf8' }}>Strategist</span>
            </span>
          </button>
          {isExpanded && (
            <div style={{ marginTop: 12 }}>
              {[{ key: 'analyst', title: 'Research Analyst', icon: 'ðŸ”', tag: 'Data & Evidence' },
                { key: 'strategist', title: 'Strategy Consultant', icon: 'ðŸ’¡', tag: 'Synthesis & Recommendations' }].map(layer => (
                <div key={layer.key} style={{ background: 'rgba(0,0,0,0.15)', borderRadius: 10, padding: 14, marginBottom: 10, borderLeft: '3px solid rgba(255,255,255,0.2)' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 10 }}>
                    <span>{layer.icon}</span>
                    <span style={{ fontWeight: 600, fontSize: 13 }}>{layer.title}</span>
                    <span style={{ marginLeft: 'auto', fontSize: 10, color: 'rgba(255,255,255,0.4)', background: 'rgba(255,255,255,0.05)', padding: '2px 8px', borderRadius: 8 }}>{layer.tag}</span>
                  </div>
                  <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, whiteSpace: 'pre-wrap' }}>{layers[layer.key]}</div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    function Message({ role, content, layers, sources, followUps, onFollowUp, showLayers }) {
      const [layersExpanded, setLayersExpanded] = useState(false);
      const formatContent = (text) => {
        let f = text.replace(/\*\*([^*]+)\*\*/g, '<strong style="color:#00b4d8">$1</strong>');
        f = f.replace(/\n\n/g, '</p><p style="margin-bottom:10px">');
        f = f.replace(/\n/g, '<br/>');
        return `<p style="margin-bottom:10px">${f}</p>`;
      };

      return (
        <div style={{ display: 'flex', gap: 12, marginBottom: 24, justifyContent: role === 'user' ? 'flex-end' : 'flex-start' }}>
          {role === 'assistant' && (
            <div style={{ width: 36, height: 36, background: 'linear-gradient(135deg, #00b4d8, #0077b6)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>
              <svg viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" style={{ width: 18, height: 18 }}>
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
            </div>
          )}
          <div style={{
            padding: '14px 18px', maxWidth: role === 'user' ? '70%' : '85%',
            background: role === 'user' ? 'linear-gradient(135deg, #0077b6, #00b4d8)' : 'rgba(255,255,255,0.05)',
            border: role === 'assistant' ? '1px solid rgba(255,255,255,0.08)' : 'none',
            borderRadius: role === 'user' ? '16px 16px 4px 16px' : '4px 16px 16px 16px'
          }}>
            <div style={{ lineHeight: 1.65, fontSize: 14 }} dangerouslySetInnerHTML={{ __html: formatContent(content) }} />
            {role === 'assistant' && showLayers && <AgentLayers layers={layers} isExpanded={layersExpanded} onToggle={() => setLayersExpanded(!layersExpanded)} />}
            {role === 'assistant' && sources && (
              <div style={{ marginTop: 16, paddingTop: 14, borderTop: '1px solid rgba(255,255,255,0.08)' }}>
                <span style={{ fontSize: 10, textTransform: 'uppercase', letterSpacing: 1, color: 'rgba(255,255,255,0.4)', display: 'block', marginBottom: 10 }}>Sources referenced:</span>
                {sources.map((s, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 10, background: 'rgba(0,0,0,0.2)', padding: '8px 12px', borderRadius: 8, marginBottom: 6 }}>
                    <span>ðŸ“Š</span>
                    <div><div style={{ fontSize: 12, fontWeight: 500 }}>{s.title}</div><div style={{ fontSize: 10, color: 'rgba(255,255,255,0.4)' }}>Oliver Wyman Research</div></div>
                  </div>
                ))}
              </div>
            )}
            {role === 'assistant' && followUps && (
              <div style={{ marginTop: 14, paddingTop: 14, borderTop: '1px solid rgba(255,255,255,0.08)' }}>
                <span style={{ fontSize: 10, textTransform: 'uppercase', letterSpacing: 1, color: 'rgba(255,255,255,0.4)', display: 'block', marginBottom: 10 }}>Suggested follow-ups:</span>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>
                  {followUps.map((f, i) => (
                    <button key={i} onClick={() => onFollowUp(f)} style={{ background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',
                      padding: '8px 14px', borderRadius: 16, color: 'rgba(255,255,255,0.8)', fontSize: 12, cursor: 'pointer' }}>{f}</button>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // =============================================
    // MAIN APP
    // =============================================
    function App() {
      const [activeTab, setActiveTab] = useState('chat');
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [showWelcome, setShowWelcome] = useState(true);
      const [showAgentLayers, setShowAgentLayers] = useState(true);
      const messagesEndRef = useRef(null);

      useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

      const sendMessage = async (text) => {
        if (!text.trim()) return;
        setShowWelcome(false);
        setMessages(prev => [...prev, { role: 'user', content: text }]);
        setInput('');
        setIsLoading(true);

        let responseData;
        if (CONFIG.DEMO_MODE) {
          await new Promise(r => setTimeout(r, 1500));
          responseData = getResponseData(text);
        } else {
          try {
            const res = await fetch(CONFIG.WEBHOOK_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: text })
            });
            const data = await res.json();
            responseData = { 
              data: { executive: data.response || data.message, analyst: data.layers?.analyst, strategist: data.layers?.strategist },
              topic: 'default'
            };
          } catch (e) {
            responseData = getResponseData(text); // Fallback to mock
          }
        }

        const sources = [
          { title: 'Qatar Manufacturing Competitiveness Assessment 2024' },
          { title: 'Digital Transformation Playbook' }
        ];

        setMessages(prev => [...prev, {
          role: 'assistant',
          content: responseData.data.executive,
          layers: { analyst: responseData.data.analyst, strategist: responseData.data.strategist },
          sources,
          followUps: getFollowUps(responseData.topic)
        }]);
        setIsLoading(false);
      };

      return (
        <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #0a0f1c 0%, #1a1f35 50%, #0d1321 100%)', fontFamily: "'DM Sans', sans-serif", color: '#e8eaed', display: 'flex', flexDirection: 'column' }}>
          {/* Header */}
          <header style={{ padding: '16px 24px', borderBottom: '1px solid rgba(255,255,255,0.08)', display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: 'rgba(10,15,28,0.9)', backdropFilter: 'blur(20px)', position: 'sticky', top: 0, zIndex: 100 }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
              <div style={{ width: 38, height: 38, background: 'linear-gradient(135deg, #00b4d8, #0077b6)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 700, fontSize: 16, color: 'white' }}>OW</div>
              <div>
                <div style={{ fontFamily: "'DM Serif Display', serif", fontSize: 20, color: '#fff' }}>Manufacturing Sector Advisor</div>
                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', textTransform: 'uppercase', letterSpacing: 1 }}>Qatar Strategic Initiative</div>
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
              {CONFIG.SHOW_SIMULATOR && (
                <div style={{ display: 'flex', background: 'rgba(255,255,255,0.05)', borderRadius: 8, padding: 4 }}>
                  {['chat', 'simulator'].map(tab => (
                    <button key={tab} onClick={() => setActiveTab(tab)} style={{
                      padding: '8px 16px', borderRadius: 6, border: 'none', cursor: 'pointer', fontSize: 13, fontWeight: 500,
                      background: activeTab === tab ? 'rgba(0,180,216,0.2)' : 'transparent',
                      color: activeTab === tab ? '#00b4d8' : 'rgba(255,255,255,0.6)'
                    }}>{tab === 'chat' ? 'ðŸ’¬ Chat' : 'ðŸ“Š Simulator'}</button>
                  ))}
                </div>
              )}
              {activeTab === 'chat' && (
                <button onClick={() => setShowAgentLayers(!showAgentLayers)} style={{
                  display: 'flex', alignItems: 'center', gap: 6, padding: '8px 12px', background: showAgentLayers ? 'rgba(0,180,216,0.15)' : 'rgba(255,255,255,0.05)',
                  border: `1px solid ${showAgentLayers ? 'rgba(0,180,216,0.3)' : 'rgba(255,255,255,0.1)'}`, borderRadius: 8,
                  color: showAgentLayers ? '#00b4d8' : '#e8eaed', fontSize: 12, cursor: 'pointer'
                }}>ðŸ§  AI Reasoning</button>
              )}
            </div>
          </header>

          {/* Main Content */}
          {activeTab === 'simulator' ? (
            <ScenarioSimulator />
          ) : (
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', maxWidth: 900, width: '100%', margin: '0 auto', padding: '0 20px' }}>
              {showWelcome && messages.length === 0 ? (
                <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', textAlign: 'center', padding: '40px 20px' }}>
                  <div style={{ width: 70, height: 70, background: 'linear-gradient(135deg, rgba(0,180,216,0.2), rgba(0,119,182,0.2))', borderRadius: 20, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 24, border: '1px solid rgba(0,180,216,0.3)' }}>
                    <svg viewBox="0 0 24 24" fill="none" stroke="#00b4d8" strokeWidth="2" style={{ width: 35, height: 35 }}>
                      <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                  </div>
                  <h1 style={{ fontFamily: "'DM Serif Display', serif", fontSize: 32, color: '#fff', marginBottom: 12 }}>Qatar Manufacturing Intelligence</h1>
                  <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)', maxWidth: 450, lineHeight: 1.5, marginBottom: 32 }}>
                    Multi-agent AI analysis with transparent reasoning. Ask about productivity, technology, sectors, or GDP impact.
                  </p>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: 10, justifyContent: 'center', maxWidth: 550 }}>
                    {["What's the biggest GDP opportunity?", "Tell me about F&B potential", "How can we improve productivity?", "What's blocking digital adoption?"].map((q, i) => (
                      <button key={i} onClick={() => sendMessage(q)} style={{
                        background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '10px 16px',
                        borderRadius: 20, color: '#e8eaed', fontSize: 13, cursor: 'pointer'
                      }}>{q}</button>
                    ))}
                  </div>
                </div>
              ) : (
                <div style={{ flex: 1, overflowY: 'auto', padding: '24px 0' }}>
                  {messages.map((msg, i) => <Message key={i} {...msg} showLayers={showAgentLayers} onFollowUp={sendMessage} />)}
                  {isLoading && (
                    <div style={{ display: 'flex', gap: 12, marginBottom: 24 }}>
                      <div style={{ width: 36, height: 36, background: 'linear-gradient(135deg, #00b4d8, #0077b6)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" style={{ width: 18, height: 18 }}>
                          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                      </div>
                      <div style={{ display: 'flex', gap: 6, padding: 16 }}>
                        {[0, 0.2, 0.4].map((d, i) => (
                          <div key={i} style={{ width: 8, height: 8, background: '#00b4d8', borderRadius: '50%', animation: `bounce 1.4s ease-in-out infinite ${d}s` }} />
                        ))}
                      </div>
                    </div>
                  )}
                  <div ref={messagesEndRef} />
                </div>
              )}

              {/* Input */}
              <div style={{ padding: '16px 0 24px', position: 'sticky', bottom: 0, background: 'linear-gradient(to top, rgba(10,15,28,1) 50%, transparent 100%)' }}>
                <form onSubmit={e => { e.preventDefault(); sendMessage(input); }} style={{ display: 'flex', gap: 10, background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: 14, padding: '6px 6px 6px 16px' }}>
                  <input type="text" value={input} onChange={e => setInput(e.target.value)} placeholder="Ask about Qatar's manufacturing sector..."
                    disabled={isLoading} style={{ flex: 1, background: 'transparent', border: 'none', color: '#e8eaed', fontSize: 14, outline: 'none' }} />
                  <button type="submit" disabled={isLoading || !input.trim()} style={{
                    width: 40, height: 40, background: 'linear-gradient(135deg, #00b4d8, #0077b6)', border: 'none', borderRadius: 10, cursor: 'pointer',
                    display: 'flex', alignItems: 'center', justifyContent: 'center', opacity: isLoading || !input.trim() ? 0.5 : 1
                  }}>
                    <svg viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" style={{ width: 18, height: 18 }}>
                      <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                  </button>
                </form>
              </div>
            </div>
          )}

          <style>{`
            @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-8px); } }
            input::placeholder { color: rgba(255,255,255,0.3); }
            input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: linear-gradient(135deg, #00b4d8, #0077b6); cursor: pointer; }
          `}</style>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
